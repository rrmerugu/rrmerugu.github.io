<!doctype html><html><head><title>Automating python tasks with Celery</title><meta charset=utf-8><meta name=X-UA-Compatible content="IE=edge"><meta name=google-site-verification content><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><meta content="telephone=no" name=format-detection><meta name=description content><meta name=renderer content="webkit"><meta name=theme-color content="#ffffff"><link type=text/css rel=stylesheet href=/vendor/css/bootstrap.min.css><link rel=icon href=https://rrmerugu.github.io/img/favicon/favicon.ico><link rel=stylesheet href=https://rrmerugu.github.io/scss/journal.min.1d4a9e07ca6d232003cfe661077e042db270aefb933deeeb14b0b40b033c26fd.css integrity="sha256-HUqeB8ptIyADz+ZhB34ELbJwrvuTPe7rFLC0CwM8Jv0=" media=screen><link rel=stylesheet href=https://rrmerugu.github.io/scss/dark-mode.min.be02037df174ed1be7c5b8491984e64944bf1a7ea9046230dee5d498e75913f3.css integrity="sha256-vgIDffF07RvnxbhJGYTmSUS/Gn6pBGIw3uXUmOdZE/M=" media=screen><script src=/vendor/js/loadCSS.js></script>
<script>loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons")</script><script src=/js/toc.js></script></head><body><div id=app><div id=sideContainer class=side-container><img src=https://github.com/rrmerugu.png width=200 class="img-fluid rounded-circle ml-3" alt="Ravi Raja Merugu"><div class=nav-head><div class=nav-title>Ravi Raja Merugu</div><div class=nav-subtitle>So much to learn about organising data as knowledge</div></div><ul class=nav><li class="nav-item pl-4"><span class="fas fa-building"></span>
Hyderabad, IN</li><li class="nav-item pl-4"><span class="fas fa-briefcase"></span></li><li class=nav-item><a href=https://invana.io target=_blank rel=noopener aria-label=invana title=invana class="nav-link p-0 ml-2">@invana</a></li><li class=nav-item><a href=https://eoncollective.com target=_blank rel=noopener aria-label=eoncollective title=eoncollective class="nav-link p-0 ml-2">@eoncollective</a></li></ul><ul class="nav mt-2 ml-1"><li class=nav-item><a href=https://github.com/rrmerugu target=_blank rel=noopener aria-label=GitHub title=GitHub class=nav-link><span class="fab fa-github fa-2x" aria-hidden=true></span></a></li><li class=nav-item><a href=https://twitter.com/rrmerugu target=_blank rel=noopener aria-label=Twitter title=Twitter class=nav-link><span class="fab fa-twitter fa-2x" aria-hidden=true></span></a></li><li class=nav-item><a href=mailto:rrmerugu@gmail.com target=_blank rel=noopener aria-label=e-mail title=e-mail class=nav-link><span class="fas fa-envelope fa-2x" aria-hidden=true></span></a></li><li class=nav-item><a href=https://www.linkedin.com/in/rrmerugu/ target=_blank rel=noopener aria-label=LinkedIn title=LinkedIn class=nav-link><span class="fab fa-linkedin fa-2x" aria-hidden=true></span></a></li></ul><div class=nav-link-list><a class="a-block nav-link-item false" href=/>Home</a>
<a class="a-block nav-link-item false" href=/posts>Posts</a>
<a class="a-block nav-link-item active" href=/projects>Projects</a>
<a class="a-block nav-link-item false" href=/talks>Talks</a>
<a class="a-block nav-link-item false" href=/papers>Research Papers</a>
<a class="a-block nav-link-item false" href=/tags>Tags</a>
<a class="a-block nav-link-item false" href=/categories>Categories</a></div><div class=nav-footer>Built with modified version of Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a><br>&copy;
2020 Ravi Raja Merugu
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css><style>.side-container{text-align:left}@media screen{.side-container .nav-link-list .nav-link-item{padding-left:1rem;padding-right:1rem}}@media screen and (max-width:1020px){.single-column-header-container{padding:10px 20px}.single-column-header-subtitle{}.stream-container .post .post-head-wrapper-text-only .post-title{font-size:24px}}.extra-container .pagination{display:unset!important}</style></div></div><div id=extraContainer class=extra-container><div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }"></div><div class=pagination><a id=globalBackToTop class="pagination-action animated-visibility" href=#top :class="{ invisible: scrollY == 0 }"><i class="material-icons pagination-action-icon">keyboard_arrow_up</i></a>
<a type=button class=pagination-action id=darkModeToggleButton><span class="material-icons pagination-action-icon" id=darkModeToggleIcon>dark_mode</span></a></div></div><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css><div class=single-column-drawer-container id=drawer v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }"><div class=drawer-content><div class=drawer-menu><ul class="nav mb-2"><li class="nav-item pl-4"><span class="fas fa-building"></span>
Hyderabad, IN</li></ul><ul class="nav mb-4"><li class="nav-item pl-4"><span class="fas fa-briefcase"></span></li><li class=nav-item><a href=https://invana.io target=_blank rel=noopener aria-label=invana title=invana class="nav-link p-0 ml-2">@invana</a></li><li class=nav-item><a href=https://eoncollective.com target=_blank rel=noopener aria-label=eoncollective title=eoncollective class="nav-link p-0 ml-2">@eoncollective</a></li></ul><a class="a-block drawer-menu-item false" href=/>Home</a>
<a class="a-block drawer-menu-item false" href=/posts>Posts</a>
<a class="a-block drawer-menu-item active" href=/projects>Projects</a>
<a class="a-block drawer-menu-item false" href=/talks>Talks</a>
<a class="a-block drawer-menu-item false" href=/papers>Research Papers</a>
<a class="a-block drawer-menu-item false" href=/tags>Tags</a>
<a class="a-block drawer-menu-item false" href=/categories>Categories</a><div class=toc></div></div></div></div><transition name=fade><div id=drawer-mask v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if=isDrawerOpen v-on:click=toggleDrawer></div></transition><nav id=navBar class="navbar sticky-top navbar-light single-column-nav-container"><div id=navBackground class=nav-background></div><div class="container container-narrow nav-content"><button id=nav_dropdown_btn class=nav-dropdown-toggle type=button v-on:click=toggleDrawer>
<i class=material-icons>menu</i></button>
<a id=navTitle class=navbar-brand href=https://rrmerugu.github.io/>Ravi Raja Merugu</a>
<button type=button class=nav-darkmode-toggle id=darkModeToggleButton2>
<i class=material-icons id=darkModeToggleIcon2>dark_mode</i></button></div></nav><div class=single-column-header-container id=pageHead v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }"><a href=https://rrmerugu.github.io/><div class=single-column-header-title>Ravi Raja Merugu</div><div class=single-column-header-subtitle>So much to learn about organising data as knowledge</div></a><ul class="nav justify-content-center mt-2"><li class=nav-item><a href=https://github.com/rrmerugu target=_blank rel=noopener aria-label=GitHub title=GitHub class=nav-link><span class="fab fa-github" aria-hidden=true></span></a></li><li class=nav-item><a href=https://twitter.com/rrmerugu target=_blank rel=noopener aria-label=Twitter title=Twitter class=nav-link><span class="fab fa-twitter" aria-hidden=true></span></a></li><li class=nav-item><a href=mailto:rrmerugu@gmail.com target=_blank rel=noopener aria-label=e-mail title=e-mail class=nav-link><span class="fas fa-envelope" aria-hidden=true></span></a></li><li class=nav-item><a href=https://www.linkedin.com/in/rrmerugu/ target=_blank rel=noopener aria-label=LinkedIn title=LinkedIn class=nav-link><span class="fab fa-linkedin" aria-hidden=true></span></a></li></ul></div><div id=content><div id=streamContainer class=stream-container><div class="post-list-container post-list-container-shadow"><div class=post><div class=post-head-wrapper-text-only><div class=post-title>Automating python tasks with Celery<div class=post-meta><time itemprop=datePublished-2 class=mr-2>2018-02-14 00:00</time>
<i class=material-icons>label</i>
<a href=/tags/celery>Celery</a>
&nbsp;
<a href=/tags/python>Python</a>
&nbsp;
<i class=material-icons>schedule</i>
40 s.</div></div></div><div class=post-body-wrapper><div class=post-body v-pre><p>The example will use mongodb as broker and results backend</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74># tasks.py
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http://docs.celeryproject.org/en/latest/getting-started/first-steps-with-celery.html
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http://docs.celeryproject.org/en/latest/getting-started/next-steps.html#project-layout
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>http://docs.celeryproject.org/en/latest/userguide/periodic-tasks.html?highlight=add_periodic_task
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>celery -A tasks worker --loglevel=info
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>python tasks.py # executes the add.delay() things
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74># runs the periodic tasks
</span></span></span><span style=display:flex><span><span style=color:#e6db74>celery worker -l info -A tasks --beat
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> celery <span style=color:#f92672>import</span> Celery
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> celery.schedules <span style=color:#f92672>import</span> crontab
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> celery.task <span style=color:#f92672>import</span> periodic_task
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> timedelta
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> random <span style=color:#f92672>import</span> randint
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Celery(<span style=color:#e6db74>&#39;tasks&#39;</span>, broker<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mongodb://127.0.0.1:27017/tasksdb&#39;</span>, backend<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mongodb://127.0.0.1:27017/tasksdb&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>task
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add</span>(x, y):
</span></span><span style=display:flex><span>    z <span style=color:#f92672>=</span> x <span style=color:#f92672>+</span> y
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;z is </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(z))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> x <span style=color:#f92672>+</span> y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@periodic_task</span>(run_every<span style=color:#f92672>=</span>timedelta(seconds<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>periodic_task_example</span>():
</span></span><span style=display:flex><span>    add<span style=color:#f92672>.</span>delay(randint(<span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>55</span>), randint(<span style=color:#ae81ff>445</span>, <span style=color:#ae81ff>56666</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    add<span style=color:#f92672>.</span>delay(<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>    add<span style=color:#f92672>.</span>delay(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>    add<span style=color:#f92672>.</span>delay(<span style=color:#ae81ff>1000</span>, <span style=color:#ae81ff>7</span>)
</span></span><span style=display:flex><span>    add<span style=color:#f92672>.</span>delay(<span style=color:#ae81ff>4123</span>, <span style=color:#ae81ff>41231</span>)
</span></span></code></pre></td></tr></table></div></div><hr width=100% id=EOF><p style=color:#777>Last modified on 2018-02-14</p></div></div><nav class=post-pagination><a class=newer-posts href=https://rrmerugu.github.io/projects/elasticsearch-notes/>Next<br>Elasticsearch Notes on Queries</a>
<a class=older-posts href=https://rrmerugu.github.io/posts/django-celery-rabbitmq/>Previous<br>Async tasks with Django + RabbitMQ + Celery</a></nav><div class=post-comment-wrapper></div></div></div></div></div><div id=single-column-footer>Built with modified version of Hugo Theme <a href=https://github.com/amazingrise/hugo-theme-diary>Diary</a><br>&copy;
2020 Ravi Raja Merugu
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css><style>.side-container{text-align:left}@media screen{.side-container .nav-link-list .nav-link-item{padding-left:1rem;padding-right:1rem}}@media screen and (max-width:1020px){.single-column-header-container{padding:10px 20px}.single-column-header-subtitle{}.stream-container .post .post-head-wrapper-text-only .post-title{font-size:24px}}.extra-container .pagination{display:unset!important}</style></div></div><script src=/js/journal.js></script></body></html>